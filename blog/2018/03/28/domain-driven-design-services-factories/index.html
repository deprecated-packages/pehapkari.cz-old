<!DOCTYPE html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="description" content="Oficiální stránky PHP komunity">
<meta name="keywords" content="PHP, komunita, programování">
<meta name="author" content="https://pehapkari.cz">
<meta name="robots" content="index, follow">

<meta property="og:image" content="/images/php-square.png">
<meta property="fb:pages" content="918297778220033" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="alternate" type="application/rss+xml" title="Péhápkaři.cz Blog RSS" href="/rss.xml">

<link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/assets/bootstrap/bootstrap.min.css?v=1336058604" rel="stylesheet" type="text/css" />

<link href="/assets/prism/prism.css?v=2084757336" rel="stylesheet" type="text/css" />
<link href="/assets/prism/prism-custom.css?v=1719568576" rel="stylesheet" type="text/css" />

<link href="/assets/css/style.css?v=624968248" rel="stylesheet" type="text/css" />

<link href="/favicon.ico" rel="shortcut icon">

<title>Domain-Driven Design, part 8 - Services and Factories </title>
        <meta property="og:type" content="article" />
<meta property="og:title" content="Domain-Driven Design, part 8 - Services and Factories" />
<meta property="og:description" content="This article is a reaction to readers’ confusion about services.
We&#039;ll cover a domain service and domain factory in this article and when to use them and when not to." />
<meta property="og:url" content="https://pehapkari.cz/blog/2018/03/28/domain-driven-design-services-factories/" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Domain-Driven Design, part 8 - Services and Factories" />
<meta name="twitter:description" content="This article is a reaction to readers’ confusion about services.
We&#039;ll cover a domain service and domain factory in this article and when to use them and when not to." />
    </head>

    <body>
        <header>
        <div class="hidden-sm-down">
        <div class="container-fluid">
            <a href="/"><img src="/assets/images/logo-header.svg?ver" alt="" height="50"></a>

            <nav class="navbar top-navigation">
                <a href="/blog/" class="">
                    <em class="fa fa-newspaper-o fa-fw"></em>
                    Blog
                </a>
                <a href="/vzdelavej-se/" class="">
                    <em class="fa fa-graduation-cap fa-fw"></em>
                    Školení
                </a>
            </nav>
        </div>
    </div>

        <div id="mobile-menu" class="row text-center hidden-md-up">
        <div class="container">
            <a href="/" class="col-4 col-sm-4 ">
                <em class="fa fa-home"></em>
                <br>
                Home
            </a>
            <a href="/blog/" class="col-4 col-sm-4 ">
                <em class="fa fa-book fa-fw"></em>
                <br>
                Blog
            </a>
            <a href="/vzdelavej-se/" class="col-4 col-sm-4 ">
                <em class="fa fa-graduation-cap fa-fw"></em>
                <br>
                Školení
            </a>
        </div>
    </div>
</header>
        <div id="article">
            <div class="container">
                <h1 class="h2 text-center">Domain-Driven Design, part 8 - Services and Factories</h1>

                <div class="row text-center">
                    <div class="col-md-12">
                        <div class="metadataLine">
    
    <p>
        <em class="fa fa-clock-o fa-fw"></em>
        3 min

        |

        by <strong>Svaťa Šimara</strong>

        &ndash;

        <time datetime="2018-03-Wed">
            28. 3. 2018
        </time>

            </p>
</div>
                    </div>
                </div>

                <br>

                <div id="article-content">
                    <p class="perex">This article is a reaction to readers’ confusion about services.
We'll cover a domain service and domain factory in this article and when to use them and when not to.</p>

                    <p>Domain-driven design is about the domain.
Domain services and domain factories do not exist in the domain.
In general we shouldn't use them.</p>
<p>They are artificial constructions and this causes a lot of problems with code understanding, maintainability and also divergence between the domain, the model and the code.</p>
<h2 id="domain-service"><a href="#domain-service">Domain Service</a></h2>
<p>We encapsulate domain use cases into domain aggregates, entities and value objects.
This works well for many use cases.
But when a single use case involves multiple aggregates, we have a problem.</p>
<p>It may happen that use case doesn't naturally belong to any aggregate.
And it is awkward when one aggregate contains the domain logic of another aggregate.</p>
<p>A domain service is a stateless service object.
It encapsulates a single use case that involves more aggregates.</p>
<h3 id="cart-and-order-example"><a href="#cart-and-order-example">Cart and Order Example</a></h3>
<p>We have an e-shop that contains shopping carts and orders.
The order is a pretty complicated aggregate and so is the cart.</p>
<p>The complicated use case is <em>to order the cart</em>.
This use case involves at least two aggregates - cart and order.
It doesn't belong to the cart - the cart is a shopping box not responsible for the order.
It doesn't belong to the order - order doesn't care about source of its items.
But conversion is still a single use case.</p>
<p>The solution is a domain service that does exactly this complicated use case.</p>
<p><img src="/assets/images/posts/2018/ddd-services-factories/service.png" alt="service has cart as an input and order as an outpu" /></p>
<h3 id="don-t-use-domain-services"><a href="#don-t-use-domain-services">Don't use Domain Services</a></h3>
<p>Do not use domain services too much.
We usually end up with an anemic model with behavior in services.
And that is not the object-oriented programming.</p>
<h3 id="application-service"><a href="#application-service">Application Service</a></h3>
<p>Do not mix domain services with application services you may know.
Application services, as far as I know, are something from the application architecture.
But application services are in a different layer - application.</p>
<p>I think that common confusion comes from the fact that both types work with domain objects.</p>
<p>Remember that domain service has no state; it doesn't contain any private property.
Domain services are rare and contain complicated cross-aggregate domain logic.</p>
<h2 id="domain-factory"><a href="#domain-factory">Domain Factory</a></h2>
<p>Have you ever seen how the ship engine is made?
You need a whole factory for it.</p>
<p>Factory is an object that produces complicated aggregates or sometimes also entities and value objects.
It can be used in several scenarios.</p>
<p>If the object construction is complicated, it is fine to move the construction process into a separated factory instead of using complicated constructor.</p>
<p><img src="/assets/images/posts/2018/ddd-services-factories/factory-constructor.png" alt="data goes into a factory and it creates an order" /></p>
<p>If we have a custom repository, we can delegate the object reconstruction responsibility into the factory.
We get JSON data from an API for example, we pass them into a factory and it returns a domain object.</p>
<p><img src="/assets/images/posts/2018/ddd-services-factories/factory-json.png" alt="api order repository gets data from api adapter, passes them into api order factory and factory returns order" /></p>
<p>Sometimes the object construction needs some information that we do not have, like the information from an external system.
The factory can be responsible for getting the needed information and constructing the object.
In the following example, we get the order number from an external sequence.</p>
<p><img src="/assets/images/posts/2018/ddd-services-factories/factory-sequence.png" alt="data goes into a factory and it creates an order" /></p>
<h3 id="don-t-use-domain-factories"><a href="#don-t-use-domain-factories">Don't use Domain Factories</a></h3>
<p>Factories are heavily overused.
What we usually need is a constructor.</p>
<h3 id="factory-pattern"><a href="#factory-pattern">Factory Pattern</a></h3>
<p>An argument that new objects should be created only in factories is odd.
A typical use of the factory or the abstract factory pattern is to inject them so we are able to change the implementation.
This scenario is great for UI where we have no idea whether the operating system is linux, windows or any other.</p>
<p>But this is not true in the domain layer.
In the domain layer we know exactly what implementation we are using, it is the domain object.
Not any abstract object, the exact domain object.
And the only reason for changing the domain object is a domain change.
But if the domain changes, no factory can help us, we have to refactor the code.</p>
<h2 id="tl-dr"><a href="#tl-dr">TL;DR</a></h2>
<p>Do not use them.</p>
<h2 id="references"><a href="#references">References</a></h2>
<p>EVANS, Eric.
<em>Domain-driven design: tackling complexity in the heart of software</em>.
Boston: Addison-Wesley, 2004.
ISBN 0-321-12521-5.</p>
<h2 id="contact"><a href="#contact">Contact</a></h2>
<p>Are you designing architecture and like DDD approach? Hire me, I can help you - <a href="http://svatasimara.cz/">svatasimara.cz</a></p>
                </div>
            </div>

            <br>

            <div class="intermezzo">
                <div class="container">
                    
                                            <h2 id="you-might-also-like"><a href="#you-might-also-like">You Might Also Like</a></h2>

                        <ul id="related-posts">
                                                            <li>
                                    <a href="/blog/2018/02/28/domain-driven-design-repository">Domain-Driven Design, part 5 - Repository &raquo;</a>
                                </li>
                                                            <li>
                                    <a href="/blog/2018/03/07/domain-driven-design-doctrine-repository">Domain-Driven Design, part 6 - Doctrine Repository &raquo;</a>
                                </li>
                                                            <li>
                                    <a href="/blog/2018/01/06/domain-driven-design-simplify-object-model">Domain-Driven Design, part 3 - Simplify Object Model &raquo;</a>
                                </li>
                                                            <li>
                                    <a href="/blog/2018/03/21/domain-driven-design-alternative-mapping">Domain-Driven Design, part 7 - Alternative Relational Database Mapping &raquo;</a>
                                </li>
                                                            <li>
                                    <a href="/blog/2018/02/21/domain-driven-design-implementation">Domain-Driven Design, part 4 - Implementation &raquo;</a>
                                </li>
                                                            <li>
                                    <a href="/blog/2017/12/16/domain-driven-design-model">Domain-Driven Design, part 2 - Model &raquo;</a>
                                </li>
                                                            <li>
                                    <a href="/blog/2017/12/05/domain-driven-design-language">Domain-Driven Design, part 1 - Language &raquo;</a>
                                </li>
                                                    </ul>
                                    </div>
            </div>

            <div class="container">
                <div id="disqus_thread"></div>

<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//pehapkari.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <br>
        </div>

        <script src="/assets/prism/prism.js"></script>
        <script id="dsq-count-scr" src="https://pehapkari.disqus.com/count.js" async defer></script>

        <footer>
    <div class="container-fluid pt-3 pb-3">
        <div class="row">
            <div class="col-md-3 col-6">
                <h3 class="text-light">Pro tebe</h3>

                <ul>
                    <li><a href="/press">Média ke stažení</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-6">
                <h3 class="text-light">Přidej se</h3>
                <ul>
                    <li>
                        <a href="http://bit.ly/pehapkari-newsletter">Newsletter</a>
                        (<a href="http://us8.campaign-archive.com/home/?u=dcf4beafc191796bf6c47321f&id=c4f7564a7b">všechny</a>)
                    </li>
                    <li><a href="https://www.fio.cz/ib2/transparent?a=2301196632">Transparentní účet</a></li>
                    <li><a href="mailto:tomas@pehapkari.cz">Kontakt</a></li>
                </ul>
            </div>

            <div class="col-md-3 col-6">
                <h3 class="text-light">Pracujeme</h3>
                <ul>
                    <li><a href="/vzdelavej-se">Školíme</a></li>
                    <li><a href="https://phpprague.cz">PHP Prague 2018</a></li>
                                                        </ul>
            </div>

            <div class="col-md-3 col-6 text-left">
                <h3 class="text-light mb-4">Sleduj nás na sítích</h3>

                <a href="https://www.meetup.com/friends-of-php-prague/" class="p-3 btn">
                    <em class="fa fa-2x fa-meetup"></em>
                </a>
                <a href="https://www.facebook.com/pehapkari" class="p-3 btn">
                    <em class="fa fa-2x fa-facebook"></em>
                </a>
                <a href="https://twitter.com/pehapkari" class="p-3 btn">
                    <em class="fa fa-2x fa-twitter"></em>
                </a>
                <a href="https://github.com/pehapkari" class="p-3 btn">
                    <em class="fa fa-2x fa-github"></em>
                </a>
                <a href="https://youtube.com/pehapkari/videos" class="p-3 btn">
                    <em class="fa fa-2x fa-youtube-play"></em>
                </a>
                <a href="https://pehapkari.slack.com" class="p-3 btn">
                    <em class="fa fa-2x fa-slack"></em>
                </a>
            </div>
        </div>

        <div class="row text-left pt-3">
            <div class="col-md-7 col-sm-6">
                <p class="powered-by">
                    Tento web jede na <a href="https://statie.org">Statie</a> a najdeš ho na <a href="https://github.com/pehapkari/pehapkari.cz">Githubu</a>.

                                                                                        
                                            <br>
                        <strong>Našel jsi chybu?</strong> <a href="https://github.com/pehapkari/pehapkari.cz/edit/master/source/_posts/2018/2018-03-28-domain-driven-design-services-factories.md">Oprav nám ji</a> prosím
                                    </p>
            </div>
        </div>
    </div>
</footer>

<script src="/assets/prism/prism.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89860072-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-89860072-1');
</script>
    </body>
</html>
